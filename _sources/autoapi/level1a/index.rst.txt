:mod:`level1a`
==============

.. py:module:: level1a

.. autoapi-nested-parse::

   Created on Mon Jun 17 14:24:10 2019

   Script to generate the C3S CDM Marine level1a data.

   - Reads dataset data (and supp if avail) file with module mdf_reader. This includes a data model validation mask.
   - Fixes known PT type errors in source dataset with module metmetpy
   - Selects data reports according to filtering requests
   - Rejects data reports not validiting against its data model
   - Maps to the C3S CDM header and observations tables if there is data left after cleaning (table[i].psv CDM table-like files)

   The processing unit is the source-deck monthly file.

   - Outputs data to: `/<data_path>/<release>/<dataset>/level1a/<sid-dck>/table[i]-fileID.psv`
   - Outputs invalid data to: `/<data_path>/<release>/<dataset>/level1a/invalid/<sid-dck>/fileID-data|mask.psv`
   - Outputs exluded data to: `/<data_path>/<release>/<dataset>/level1a/excluded/<sid-dck>/fileID-<element>.psv`
   - Outputs quicklook info to: `/<data_path>/<release>/<dataset>/level1a/quicklooks/<sid-dck>/fileID.json`

   Where fileID is year-month-release-update

   Before processing starts:

   - Checks the existence of all output subdirectories in level1a -> exits if fails
   - Checks the existence of the source file to be converted -> exits if fails
   - Removes all level1a products on input file resulting from previous runs

   On input data:
   --------------

   Records of input data assumed to be in sid-dck monthly partitions which imply:

   - Data for same month-year period
   - Data from a unique data model

   Inargs:
   -------

   - data_path: marine data path in file system
   - release: release tag
   - update: udpate tag
   - dataset: dataset tag
   - config_path: configuration file path
   - sid_dck: source-deck data partition (optional, from config_file otherwise)
   - year: data file year (yyyy) (optional, from config_file otherwise)
   - month: data file month (mm) (optional, from config_file otherwise)

   configfile:
   -----------

   To specify processing options that may be shared in different processing settings:

   - main data model
   - supplemental data model
   - processing options: supplemental replacements, record selection/filtering by field (i.e. PT....)

   @author: iregon



Module Contents
---------------

Classes
~~~~~~~

.. autoapisummary::

   level1a.script_setup



Functions
~~~~~~~~~

.. autoapisummary::

   level1a.clean_L1a
   level1a.write_out_junk



Attributes
~~~~~~~~~~

.. autoapisummary::

   level1a.FFS
   level1a.date_handler
   level1a.args
   level1a.params
   level1a.release_path
   level1a.FFS
   level1a.L0_path
   level1a.L1a_path
   level1a.L1a_ql_path
   level1a.L1a_excluded_path
   level1a.L1a_invalid_path
   level1a.data_paths
   level1a.L0_filename
   level1a.release_id
   level1a.L1a_id
   level1a.data_model
   level1a.dataset
   level1a.io_dict
   level1a.read_kwargs
   level1a.data_in
   level1a.dataset_metmetpy
   level1a.data_model_metmetpy
   level1a.data
   level1a.data_excluded
   level1a.newmask_buffer
   level1a.masked_columns
   level1a.chunksize
   level1a.mask
   level1a.data
   level1a.k
   level1a.data_invalid
   level1a.col
   level1a.process
   level1a.process
   level1a.tables
   level1a.L1a_io_filename
   level1a.excluded_filename
   level1a.invalid_data_filename


.. data:: FFS
   :annotation: = -

   

.. class:: script_setup(inargs)



.. data:: date_handler
   

   

.. function:: clean_L1a(L1a_id)


.. function:: write_out_junk(dataObj, filename)


.. data:: args
   

   

.. data:: params
   

   

.. data:: release_path
   

   

.. data:: FFS
   :annotation: = -

   

.. data:: L0_path
   

   

.. data:: L1a_path
   

   

.. data:: L1a_ql_path
   

   

.. data:: L1a_excluded_path
   

   

.. data:: L1a_invalid_path
   

   

.. data:: data_paths
   

   

.. data:: L0_filename
   

   

.. data:: release_id
   

   

.. data:: L1a_id
   

   

.. data:: data_model
   

   

.. data:: dataset
   

   

.. data:: io_dict
   

   

.. data:: read_kwargs
   

   

.. data:: data_in
   

   

.. data:: dataset_metmetpy
   :annotation: = icoads_r3000

   

.. data:: data_model_metmetpy
   :annotation: = imma1

   

.. data:: data
   

   

.. data:: data_excluded
   

   

.. data:: newmask_buffer
   

   

.. data:: masked_columns
   

   

.. data:: chunksize
   

   

.. data:: mask
   

   

.. data:: data
   

   

.. data:: k
   

   

.. data:: data_invalid
   

   

.. data:: col
   :annotation: = global_mask

   

.. data:: process
   :annotation: = True

   

.. data:: process
   :annotation: = False

   

.. data:: tables
   :annotation: = ['header', 'observations-at', 'observations-sst', 'observations-dpt', 'observations-wbt',...

   

.. data:: L1a_io_filename
   

   

.. data:: excluded_filename
   

   

.. data:: invalid_data_filename
   

   

